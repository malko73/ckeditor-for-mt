(function(){function a(e,f){f=f===undefined||f;var g;if(f)g=e.getComputedStyle('text-align');else{while(!e.hasAttribute||!(e.hasAttribute('align')||e.getStyle('text-align'))){var h=e.getParent();if(!h)break;e=h;}g=e.getStyle('text-align')||e.getAttribute('align')||'';}g&&(g=g.replace(/(?:-(?:moz|webkit)-)?(?:start|auto)/i,''));!g&&f&&(g=e.getComputedStyle('direction')=='rtl'?'right':'left');return g;};function b(e){if(e.editor.readOnly)return;e.editor.getCommand(this.name).refresh(e.data.path);};function c(e,f,g){var i=this;i.editor=e;i.name=f;i.value=g;var h=e.config.justifyClasses;if(h){switch(g){case 'left':i.cssClassName=h[0];break;case 'center':i.cssClassName=h[1];break;case 'right':i.cssClassName=h[2];break;case 'justify':i.cssClassName=h[3];break;}i.cssClassRegex=new RegExp('(?:^|\\s+)(?:'+h.join('|')+')(?=$|\\s)');}};function d(e){var f=e.editor,g=new CKEDITOR.dom.range(f.document);g.setStartBefore(e.data.node);g.setEndAfter(e.data.node);var h=new CKEDITOR.dom.walker(g),i;while(i=h.next()){if(i.type==CKEDITOR.NODE_ELEMENT){if(!i.equals(e.data.node)&&i.getDirection()){g.setStartAfter(i);h=new CKEDITOR.dom.walker(g);continue;}var j=f.config.justifyClasses;if(j)if(i.hasClass(j[0])){i.removeClass(j[0]);i.addClass(j[2]);}else if(i.hasClass(j[2])){i.removeClass(j[2]);i.addClass(j[0]);}var k='text-align',l=i.getStyle(k);if(l=='left')i.setStyle(k,'right');else if(l=='right')i.setStyle(k,'left');}}};c.prototype={exec:function(e){var q=this;var f=e.getSelection(),g=e.config.enterMode;if(!f)return;var h=f.createBookmarks(),i=f.getRanges(true),j=q.cssClassName,k,l,m=e.config.useComputedState;m=m===undefined||m;for(var n=i.length-1;n>=0;n--){k=i[n].createIterator();k.enlargeBr=g!=CKEDITOR.ENTER_BR;while(l=k.getNextParagraph(g==CKEDITOR.ENTER_P?'p':'div')){l.removeAttribute('align');l.removeStyle('text-align');var o=j&&(l.$.className=CKEDITOR.tools.ltrim(l.$.className.replace(q.cssClassRegex,''))),p=q.state==CKEDITOR.TRISTATE_OFF&&(!m||a(l,true)!=q.value);if(j){if(p)l.addClass(j);else if(!o)l.removeAttribute('class');}else if(p)l.setStyle('text-align',q.value);}}e.focus();e.forceNextSelectionCheck();f.selectBookmarks(h);},refresh:function(e){var f=e.block||e.blockLimit;this.setState(f.getName()!='body'&&a(f,this.editor.config.useComputedState)==this.value?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF);}};CKEDITOR.plugins.add('justify',{init:function(e){var f=new c(e,'justifyleft','left'),g=new c(e,'justifycenter','center'),h=new c(e,'justifyright','right'),i=new c(e,'justifyblock','justify');
e.addCommand('justifyleft',f);e.addCommand('justifycenter',g);e.addCommand('justifyright',h);e.addCommand('justifyblock',i);e.ui.addButton('JustifyLeft',{label:e.lang.justify.left,command:'justifyleft'});e.ui.addButton('JustifyCenter',{label:e.lang.justify.center,command:'justifycenter'});e.ui.addButton('JustifyRight',{label:e.lang.justify.right,command:'justifyright'});e.ui.addButton('JustifyBlock',{label:e.lang.justify.block,command:'justifyblock'});e.on('selectionChange',CKEDITOR.tools.bind(b,f));e.on('selectionChange',CKEDITOR.tools.bind(b,h));e.on('selectionChange',CKEDITOR.tools.bind(b,g));e.on('selectionChange',CKEDITOR.tools.bind(b,i));e.on('dirChanged',d);},requires:['domiterator']});})();

(function(){var a={ol:1,ul:1},b=/^[\n\r\t ]*$/,c=CKEDITOR.dom.walker.whitespaces(),d=CKEDITOR.dom.walker.bookmark(),e=function(B){return!(c(B)||d(B));},f=CKEDITOR.dom.walker.bogus();function g(B){var C,D,E;if(C=B.getDirection()){D=B.getParent();while(D&&!(E=D.getDirection()))D=D.getParent();if(C==E)B.removeAttribute('dir');}};function h(B,C){var D=B.getAttribute('style');D&&C.setAttribute('style',D.replace(/([^;])$/,'$1;')+(C.getAttribute('style')||''));};CKEDITOR.plugins.list={listToArray:function(B,C,D,E,F){if(!a[B.getName()])return[];if(!E)E=0;if(!D)D=[];for(var G=0,H=B.getChildCount();G<H;G++){var I=B.getChild(G);if(I.type==CKEDITOR.NODE_ELEMENT&&I.getName() in CKEDITOR.dtd.$list)CKEDITOR.plugins.list.listToArray(I,C,D,E+1);if(I.$.nodeName.toLowerCase()!='li')continue;var J={parent:B,indent:E,element:I,contents:[]};if(!F){J.grandparent=B.getParent();if(J.grandparent&&J.grandparent.$.nodeName.toLowerCase()=='li')J.grandparent=J.grandparent.getParent();}else J.grandparent=F;if(C)CKEDITOR.dom.element.setMarker(C,I,'listarray_index',D.length);D.push(J);for(var K=0,L=I.getChildCount(),M;K<L;K++){M=I.getChild(K);if(M.type==CKEDITOR.NODE_ELEMENT&&a[M.getName()])CKEDITOR.plugins.list.listToArray(M,C,D,E+1,J.grandparent);else J.contents.push(M);}}return D;},arrayToList:function(B,C,D,E,F){if(!D)D=0;if(!B||B.length<D+1)return null;var G,H=B[D].parent.getDocument(),I=new CKEDITOR.dom.documentFragment(H),J=null,K=D,L=Math.max(B[D].indent,0),M=null,N,O,P=E==CKEDITOR.ENTER_P?'p':'div';while(1){var Q=B[K],R=Q.grandparent;N=Q.element.getDirection(1);if(Q.indent==L){if(!J||B[K].parent.getName()!=J.getName()){J=B[K].parent.clone(false,1);F&&J.setAttribute('dir',F);I.append(J);}M=J.append(Q.element.clone(0,1));if(N!=J.getDirection(1))M.setAttribute('dir',N);for(G=0;G<Q.contents.length;G++)M.append(Q.contents[G].clone(1,1));K++;}else if(Q.indent==Math.max(L,0)+1){var S=B[K-1].element.getDirection(1),T=CKEDITOR.plugins.list.arrayToList(B,null,K,E,S!=N?N:null);if(!M.getChildCount()&&CKEDITOR.env.ie&&!(H.$.documentMode>7))M.append(H.createText('\xa0'));M.append(T.listNode);K=T.nextIndex;}else if(Q.indent==-1&&!D&&R){if(a[R.getName()]){M=Q.element.clone(false,true);if(N!=R.getDirection(1))M.setAttribute('dir',N);}else M=new CKEDITOR.dom.documentFragment(H);var U=R.getDirection(1)!=N,V=Q.element,W=V.getAttribute('class'),X=V.getAttribute('style'),Y=M.type==CKEDITOR.NODE_DOCUMENT_FRAGMENT&&(E!=CKEDITOR.ENTER_BR||U||X||W),Z,aa=Q.contents.length;for(G=0;G<aa;G++){Z=Q.contents[G];if(Z.type==CKEDITOR.NODE_ELEMENT&&Z.isBlockBoundary()){if(U&&!Z.getDirection())Z.setAttribute('dir',N);
h(V,Z);W&&Z.addClass(W);}else if(Y){if(!O){O=H.createElement(P);U&&O.setAttribute('dir',N);}X&&O.setAttribute('style',X);W&&O.setAttribute('class',W);O.append(Z.clone(1,1));}M.append(O||Z.clone(1,1));}if(M.type==CKEDITOR.NODE_DOCUMENT_FRAGMENT&&K!=B.length-1){var ab=M.getLast();if(ab&&ab.type==CKEDITOR.NODE_ELEMENT&&ab.getAttribute('type')=='_moz')ab.remove();if(!(ab=M.getLast(e)&&ab.type==CKEDITOR.NODE_ELEMENT&&ab.getName() in CKEDITOR.dtd.$block))M.append(H.createElement('br'));}var ac=M.$.nodeName.toLowerCase();if(!CKEDITOR.env.ie&&(ac=='div'||ac=='p'))M.appendBogus();I.append(M);J=null;K++;}else return null;O=null;if(B.length<=K||Math.max(B[K].indent,0)<L)break;}if(C){var ad=I.getFirst(),ae=B[0].parent;while(ad){if(ad.type==CKEDITOR.NODE_ELEMENT){CKEDITOR.dom.element.clearMarkers(C,ad);if(ad.getName() in CKEDITOR.dtd.$listItem)g(ad);}ad=ad.getNextSourceNode();}}return{listNode:I,nextIndex:K};}};function i(B){if(B.editor.readOnly)return null;var C=B.data.path,D=C.blockLimit,E=C.elements,F,G;for(G=0;G<E.length&&(F=E[G])&&!F.equals(D);G++){if(a[E[G].getName()])return this.setState(this.type==E[G].getName()?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF);}return this.setState(CKEDITOR.TRISTATE_OFF);};function j(B,C,D,E){var F=CKEDITOR.plugins.list.listToArray(C.root,D),G=[];for(var H=0;H<C.contents.length;H++){var I=C.contents[H];I=I.getAscendant('li',true);if(!I||I.getCustomData('list_item_processed'))continue;G.push(I);CKEDITOR.dom.element.setMarker(D,I,'list_item_processed',true);}var J=C.root,K=J.getDocument(),L,M;for(H=0;H<G.length;H++){var N=G[H].getCustomData('listarray_index');L=F[N].parent;if(!L.is(this.type)){M=K.createElement(this.type);L.copyAttributes(M,{start:1,type:1});M.removeStyle('list-style-type');F[N].parent=M;}}var O=CKEDITOR.plugins.list.arrayToList(F,D,null,B.config.enterMode),P,Q=O.listNode.getChildCount();for(H=0;H<Q&&(P=O.listNode.getChild(H));H++){if(P.getName()==this.type)E.push(P);}O.listNode.replace(C.root);};var k=/^h[1-6]$/;function l(B,C,D){var E=C.contents,F=C.root.getDocument(),G=[];if(E.length==1&&E[0].equals(C.root)){var H=F.createElement('div');E[0].moveChildren&&E[0].moveChildren(H);E[0].append(H);E[0]=H;}var I=C.contents[0].getParent();for(var J=0;J<E.length;J++)I=I.getCommonAncestor(E[J].getParent());var K=B.config.useComputedState,L,M;K=K===undefined||K;for(J=0;J<E.length;J++){var N=E[J],O;while(O=N.getParent()){if(O.equals(I)){G.push(N);if(!M&&N.getDirection())M=1;var P=N.getDirection(K);if(L!==null)if(L&&L!=P)L=null;else L=P;
break;}N=O;}}if(G.length<1)return;var Q=G[G.length-1].getNext(),R=F.createElement(this.type);D.push(R);var S,T;while(G.length){S=G.shift();T=F.createElement('li');if(S.is('pre')||k.test(S.getName()))S.appendTo(T);else{S.copyAttributes(T);if(L&&S.getDirection()){T.removeStyle('direction');T.removeAttribute('dir');}S.moveChildren(T);S.remove();}T.appendTo(R);}if(L&&M)R.setAttribute('dir',L);if(Q)R.insertBefore(Q);else R.appendTo(I);};function m(B,C,D){var E=CKEDITOR.plugins.list.listToArray(C.root,D),F=[];for(var G=0;G<C.contents.length;G++){var H=C.contents[G];H=H.getAscendant('li',true);if(!H||H.getCustomData('list_item_processed'))continue;F.push(H);CKEDITOR.dom.element.setMarker(D,H,'list_item_processed',true);}var I=null;for(G=0;G<F.length;G++){var J=F[G].getCustomData('listarray_index');E[J].indent=-1;I=J;}for(G=I+1;G<E.length;G++){if(E[G].indent>E[G-1].indent+1){var K=E[G-1].indent+1-E[G].indent,L=E[G].indent;while(E[G]&&E[G].indent>=L){E[G].indent+=K;G++;}G--;}}var M=CKEDITOR.plugins.list.arrayToList(E,D,null,B.config.enterMode,C.root.getAttribute('dir')),N=M.listNode,O,P;function Q(R){if((O=N[R?'getFirst':'getLast']())&&!(O.is&&O.isBlockBoundary())&&(P=C.root[R?'getPrevious':'getNext'](CKEDITOR.dom.walker.whitespaces(true)))&&!(P.is&&P.isBlockBoundary({br:1})))B.document.createElement('br')[R?'insertBefore':'insertAfter'](O);};Q(true);Q();N.replace(C.root);};function n(B,C){this.name=B;this.type=C;};var o=CKEDITOR.dom.walker.nodeType(CKEDITOR.NODE_ELEMENT);function p(B,C,D,E){var F,G;while(F=B[E?'getLast':'getFirst'](o)){if((G=F.getDirection(1))!==C.getDirection(1))F.setAttribute('dir',G);F.remove();D?F[E?'insertBefore':'insertAfter'](D):C.append(F,E);}};n.prototype={exec:function(B){var ae=this;var C=B.document,D=B.config,E=B.getSelection(),F=E&&E.getRanges(true);if(!F||F.length<1)return;if(ae.state==CKEDITOR.TRISTATE_OFF){var G=C.getBody();if(!G.getFirst(e)){D.enterMode==CKEDITOR.ENTER_BR?G.appendBogus():F[0].fixBlock(1,D.enterMode==CKEDITOR.ENTER_P?'p':'div');E.selectRanges(F);}else{var H=F.length==1&&F[0],I=H&&H.getEnclosedNode();if(I&&I.is&&ae.type==I.getName())ae.setState(CKEDITOR.TRISTATE_ON);}}var J=E.createBookmarks(true),K=[],L={},M=F.createIterator(),N=0;while((H=M.getNextRange())&&++N){var O=H.getBoundaryNodes(),P=O.startNode,Q=O.endNode;if(P.type==CKEDITOR.NODE_ELEMENT&&P.getName()=='td')H.setStartAt(O.startNode,CKEDITOR.POSITION_AFTER_START);if(Q.type==CKEDITOR.NODE_ELEMENT&&Q.getName()=='td')H.setEndAt(O.endNode,CKEDITOR.POSITION_BEFORE_END);
var R=H.createIterator(),S;R.forceBrBreak=ae.state==CKEDITOR.TRISTATE_OFF;while(S=R.getNextParagraph()){if(S.getCustomData('list_block'))continue;else CKEDITOR.dom.element.setMarker(L,S,'list_block',1);var T=new CKEDITOR.dom.elementPath(S),U=T.elements,V=U.length,W=null,X=0,Y=T.blockLimit,Z;for(var aa=V-1;aa>=0&&(Z=U[aa]);aa--){if(a[Z.getName()]&&Y.contains(Z)){Y.removeCustomData('list_group_object_'+N);var ab=Z.getCustomData('list_group_object');if(ab)ab.contents.push(S);else{ab={root:Z,contents:[S]};K.push(ab);CKEDITOR.dom.element.setMarker(L,Z,'list_group_object',ab);}X=1;break;}}if(X)continue;var ac=Y;if(ac.getCustomData('list_group_object_'+N))ac.getCustomData('list_group_object_'+N).contents.push(S);else{ab={root:ac,contents:[S]};CKEDITOR.dom.element.setMarker(L,ac,'list_group_object_'+N,ab);K.push(ab);}}}var ad=[];while(K.length>0){ab=K.shift();if(ae.state==CKEDITOR.TRISTATE_OFF){if(a[ab.root.getName()])j.call(ae,B,ab,L,ad);else l.call(ae,B,ab,ad);}else if(ae.state==CKEDITOR.TRISTATE_ON&&a[ab.root.getName()])m.call(ae,B,ab,L);}for(aa=0;aa<ad.length;aa++)q(ad[aa]);CKEDITOR.dom.element.clearAllMarkers(L);E.selectBookmarks(J);B.focus();}};function q(B){var C;(C=function(D){var E=B[D?'getPrevious':'getNext'](e);if(E&&E.type==CKEDITOR.NODE_ELEMENT&&E.is(B.getName())){p(B,E,null,!D);B.remove();B=E;}})();C(1);};var r=CKEDITOR.dtd,s=/[\t\r\n ]*(?:&nbsp;|\xa0)$/;function t(B,C){var D,E=B.children,F=E.length;for(var G=0;G<F;G++){D=E[G];if(D.name&&D.name in C)return G;}return F;};function u(B){return function(C){var D=C.children,E=t(C,r.$list),F=D[E],G=F&&F.previous,H;if(G&&(G.name&&G.name=='br'||G.value&&(H=G.value.match(s)))){var I=G;if(!(H&&H.index)&&I==D[0])D[0]=B||CKEDITOR.env.ie?new CKEDITOR.htmlParser.text('\xa0'):new CKEDITOR.htmlParser.element('br',{});else if(I.name=='br')D.splice(E-1,1);else I.value=I.value.replace(s,'');}};};var v={elements:{}};for(var w in r.$listItem)v.elements[w]=u();var x={elements:{}};for(w in r.$listItem)x.elements[w]=u(true);function y(B){return B.type==CKEDITOR.NODE_ELEMENT&&(B.getName() in CKEDITOR.dtd.$block||B.getName() in CKEDITOR.dtd.$listItem)&&CKEDITOR.dtd[B.getName()]['#'];};function z(B,C,D){B.fire('saveSnapshot');D.enlarge(CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS);var E=D.extractContents();C.trim(false,true);var F=C.createBookmark(),G=new CKEDITOR.dom.elementPath(C.startContainer),H=G.block,I=G.lastElement.getAscendant('li',1)||H,J=new CKEDITOR.dom.elementPath(D.startContainer),K=J.contains(CKEDITOR.dtd.$listItem),L=J.contains(CKEDITOR.dtd.$list),M;
if(H){var N=H.getBogus();N&&N.remove();}else if(L){M=L.getPrevious(e);if(M&&f(M))M.remove();}M=E.getLast();if(M&&M.type==CKEDITOR.NODE_ELEMENT&&M.is('br'))M.remove();var O=C.startContainer.getChild(C.startOffset);if(O)E.insertBefore(O);else C.startContainer.append(E);if(K){var P=A(K);if(P)if(I.contains(K)){p(P,K.getParent(),K);P.remove();}else I.append(P);}while(D.checkStartOfBlock()&&D.checkEndOfBlock()){J=new CKEDITOR.dom.elementPath(D.startContainer);var Q=J.block,R;if(Q.is('li')){R=Q.getParent();if(Q.equals(R.getLast(e))&&Q.equals(R.getFirst(e)))Q=R;}D.moveToPosition(Q,CKEDITOR.POSITION_BEFORE_START);Q.remove();}var S=D.clone(),T=B.document.getBody();S.setEndAt(T,CKEDITOR.POSITION_BEFORE_END);var U=new CKEDITOR.dom.walker(S);U.evaluator=function(W){return e(W)&&!f(W);};var V=U.next();if(V&&V.type==CKEDITOR.NODE_ELEMENT&&V.getName() in CKEDITOR.dtd.$list)q(V);C.moveToBookmark(F);C.select();B.selectionChange(1);B.fire('saveSnapshot');};function A(B){var C=B.getLast(e);return C&&C.type==CKEDITOR.NODE_ELEMENT&&C.getName() in a?C:null;};CKEDITOR.plugins.add('list',{init:function(B){var C=B.addCommand('numberedlist',new n('numberedlist','ol')),D=B.addCommand('bulletedlist',new n('bulletedlist','ul'));B.ui.addButton('NumberedList',{label:B.lang.numberedlist,command:'numberedlist'});B.ui.addButton('BulletedList',{label:B.lang.bulletedlist,command:'bulletedlist'});B.on('selectionChange',CKEDITOR.tools.bind(i,C));B.on('selectionChange',CKEDITOR.tools.bind(i,D));B.on('key',function(E){var F=E.data.keyCode;if(B.mode=='wysiwyg'&&F in {8:1,46:1}){var G=B.getSelection(),H=G.getRanges()[0];if(!H.collapsed)return;var I=new CKEDITOR.dom.elementPath(H.startContainer),J=F==8,K=B.document.getBody(),L=new CKEDITOR.dom.walker(H.clone());L.evaluator=function(W){return e(W)&&!f(W);};L.guard=function(W,X){return!(X&&W.type==CKEDITOR.NODE_ELEMENT&&W.is('table'));};var M=H.clone();if(J){var N,O;if((N=I.contains(a))&&H.checkBoundaryOfElement(N,CKEDITOR.START)&&(N=N.getParent())&&N.is('li')&&(N=A(N))){O=N;N=N.getPrevious(e);M.moveToPosition(N&&f(N)?N:O,CKEDITOR.POSITION_BEFORE_START);}else{L.range.setStartAt(K,CKEDITOR.POSITION_AFTER_START);L.range.setEnd(H.startContainer,H.startOffset);N=L.previous();if(N&&N.type==CKEDITOR.NODE_ELEMENT&&(N.getName() in a||N.is('li'))){if(!N.is('li')){L.range.selectNodeContents(N);L.reset();L.evaluator=y;N=L.previous();}O=N;M.moveToElementEditEnd(O);}}if(O){z(B,M,H);E.cancel();}else{var P=I.contains(a),Q;if(P&&H.checkBoundaryOfElement(P,CKEDITOR.START)){Q=P.getFirst(e);
if(H.checkBoundaryOfElement(Q,CKEDITOR.START)){N=P.getPrevious(e);if(A(Q)){if(N){H.moveToElementEditEnd(N);H.select();}E.cancel();}else{B.execCommand('outdent');E.cancel();}}}}}else{var R,S;Q=H.startContainer.getAscendant('li',1);if(Q){L.range.setEndAt(K,CKEDITOR.POSITION_BEFORE_END);var T=Q.getLast(e),U=T&&y(T)?T:Q,V=0;R=L.next();if(R&&R.type==CKEDITOR.NODE_ELEMENT&&R.getName() in a&&R.equals(T)){V=1;R=L.next();}else if(H.checkBoundaryOfElement(U,CKEDITOR.END))V=1;if(V&&R){S=H.clone();S.moveToElementEditStart(R);z(B,M,S);E.cancel();}}else{L.range.setEndAt(K,CKEDITOR.POSITION_BEFORE_END);R=L.next();if(R&&R.type==CKEDITOR.NODE_ELEMENT&&R.getName() in a){R=R.getFirst(e);if(I.block&&H.checkStartOfBlock()&&H.checkEndOfBlock()){I.block.remove();H.moveToElementEditStart(R);H.select();E.cancel();}else if(A(R)){H.moveToElementEditStart(R);H.select();E.cancel();}else{S=H.clone();S.moveToElementEditStart(R);z(B,M,S);E.cancel();}}}}setTimeout(function(){B.selectionChange(1);});}});},afterInit:function(B){var C=B.dataProcessor;if(C){C.dataFilter.addRules(v);C.htmlFilter.addRules(x);}},requires:['domiterator']});})();

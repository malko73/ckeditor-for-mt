(function(){function a(){var u=this;try{var r=u.getSelection();if(!r||!r.document.getWindow().$)return;var s=r.getStartElement(),t=new CKEDITOR.dom.elementPath(s);if(!t.compare(u._.selectionPreviousPath)){u._.selectionPreviousPath=t;u.fire('selectionChange',{selection:r,path:t,element:s});}}catch(v){}};var b,c;function d(){c=true;if(b)return;e.call(this);b=CKEDITOR.tools.setTimeout(e,200,this);};function e(){b=null;if(c){CKEDITOR.tools.setTimeout(a,0,this);c=false;}};function f(r){function s(w,x){if(!w||w.type==CKEDITOR.NODE_TEXT)return false;var y=r.clone();return y['moveToElementEdit'+(x?'End':'Start')](w);};var t=r.startContainer,u=r.getPreviousNode(o,null,t),v=r.getNextNode(o,null,t);if(s(u)||s(v,1))return true;if(!(u||v)&&!(t.type==CKEDITOR.NODE_ELEMENT&&t.isBlockBoundary()&&t.getBogus()))return true;return false;};var g={modes:{wysiwyg:1,source:1},readOnly:CKEDITOR.env.ie||CKEDITOR.env.webkit,exec:function(r){switch(r.mode){case 'wysiwyg':r.document.$.execCommand('SelectAll',false,null);r.forceNextSelectionCheck();r.selectionChange();break;case 'source':var s=r.textarea.$;if(CKEDITOR.env.ie)s.createTextRange().execCommand('SelectAll');else{s.selectionStart=0;s.selectionEnd=s.value.length;}s.focus();}},canUndo:false};function h(r){k(r);var s=r.createText('​');r.setCustomData('cke-fillingChar',s);return s;};function i(r){return r&&r.getCustomData('cke-fillingChar');};function j(r){var s=r&&i(r);if(s)if(s.getCustomData('ready'))k(r);else s.setCustomData('ready',1);};function k(r){var s=r&&r.removeCustomData('cke-fillingChar');if(s){var t,u=r.getSelection().getNative(),v=u&&u.type!='None'&&u.getRangeAt(0);if(s.getLength()>1&&v&&v.intersectsNode(s.$)){t=[u.anchorOffset,u.focusOffset];var w=u.anchorNode==s.$&&u.anchorOffset>0,x=u.focusNode==s.$&&u.focusOffset>0;w&&t[0]--;x&&t[1]--;l(u)&&t.unshift(t.pop());}s.setText(s.getText().replace(/\u200B/g,''));if(t){var y=u.getRangeAt(0);y.setStart(y.startContainer,t[0]);y.setEnd(y.startContainer,t[1]);u.removeAllRanges();u.addRange(y);}}};function l(r){if(!r.isCollapsed){var s=r.getRangeAt(0);s.setStart(r.anchorNode,r.anchorOffset);s.setEnd(r.focusNode,r.focusOffset);return s.collapsed;}};CKEDITOR.plugins.add('selection',{init:function(r){if(CKEDITOR.env.webkit){r.on('selectionChange',function(){j(r.document);});r.on('beforeSetMode',function(){k(r.document);});var s,t;function u(){var w=r.document,x=i(w);if(x){var y=w.$.defaultView.getSelection();if(y.type=='Caret'&&y.anchorNode==x.$)t=1;s=x.getText();x.setText(s.replace(/\u200B/g,''));
}};function v(){var w=r.document,x=i(w);if(x){x.setText(s);if(t){w.$.defaultView.getSelection().setPosition(x.$,x.getLength());t=0;}}};r.on('beforeUndoImage',u);r.on('afterUndoImage',v);r.on('beforeGetData',u,null,null,0);r.on('getData',v);}r.on('contentDom',function(){var w=r.document,x=CKEDITOR.document,y=w.getBody(),z=w.getDocumentElement();if(CKEDITOR.env.ie){var A,B,C=1;y.on('focusin',function(J){if(J.data.$.srcElement.nodeName!='BODY')return;var K=w.getCustomData('cke_locked_selection');if(K){K.unlock(1);K.lock();}else if(A&&C){try{A.select();}catch(L){}A=null;}});y.on('focus',function(){B=1;I();});y.on('beforedeactivate',function(J){if(J.data.$.toElement)return;B=0;C=1;});CKEDITOR.env.ie&&r.on('blur',function(){try{w.$.selection.empty();}catch(J){}});z.on('mousedown',function(){C=0;});z.on('mouseup',function(){C=1;});var D;y.on('mousedown',function(J){if(J.data.$.button==2){var K=r.document.$.selection;if(K.type=='None')D=r.window.getScrollPosition();}H();});y.on('mouseup',function(J){if(J.data.$.button==2&&D){r.document.$.documentElement.scrollLeft=D.x;r.document.$.documentElement.scrollTop=D.y;}D=null;B=1;setTimeout(function(){I(true);},0);});y.on('keydown',H);y.on('keyup',function(){B=1;I();});if(w.$.compatMode!='BackCompat'){if(CKEDITOR.env.ie7Compat||CKEDITOR.env.ie6Compat){function E(J,K,L){try{J.moveToPoint(K,L);}catch(M){}};z.on('mousedown',function(J){function K(P){P=P.data.$;if(N){var Q=y.$.createTextRange();E(Q,P.x,P.y);N.setEndPoint(O.compareEndPoints('StartToStart',Q)<0?'EndToEnd':'StartToStart',Q);N.select();}};function L(){x.removeListener('mouseup',M);z.removeListener('mouseup',M);};function M(){z.removeListener('mousemove',K);L();N.select();};J=J.data;if(J.getTarget().is('html')&&J.$.x<z.$.clientWidth&&J.$.y<z.$.clientHeight){var N=y.$.createTextRange();E(N,J.$.x,J.$.y);var O=N.duplicate();z.on('mousemove',K);x.on('mouseup',M);z.on('mouseup',M);}});}if(CKEDITOR.env.ie8){z.on('mousedown',function(J){if(J.data.getTarget().is('html')){x.on('mouseup',G);z.on('mouseup',G);}});function F(){x.removeListener('mouseup',G);z.removeListener('mouseup',G);};function G(){F();var J=CKEDITOR.document.$.selection,K=J.createRange();if(J.type!='None'&&K.parentElement().ownerDocument==w.$)K.select();};}}w.on('selectionchange',I);function H(){B=0;};function I(J){if(B){var K=r.document,L=r.getSelection(),M=L&&L.getNative();if(J&&M&&M.type=='None')if(!K.$.queryCommandEnabled('InsertImage')){CKEDITOR.tools.setTimeout(I,50,this,true);return;}var N;if(M&&M.type&&M.type!='Control'&&(N=M.createRange())&&(N=N.parentElement())&&(N=N.nodeName)&&N.toLowerCase() in {input:1,textarea:1})return;
try{A=M&&L.getRanges()[0];}catch(O){}d.call(r);}};}else{w.on('mouseup',d,r);w.on('keyup',d,r);w.on('selectionchange',d,r);}if(CKEDITOR.env.webkit)w.on('keydown',function(J){var K=J.data.getKey();switch(K){case 13:case 33:case 34:case 35:case 36:case 37:case 39:case 8:case 45:case 46:k(r.document);}},null,null,-1);});r.on('contentDomUnload',r.forceNextSelectionCheck,r);r.addCommand('selectAll',g);r.ui.addButton('SelectAll',{label:r.lang.selectAll,command:'selectAll'});r.selectionChange=function(w){(w?a:d).call(this);};CKEDITOR.env.ie9Compat&&r.on('destroy',function(){var w=r.getSelection();w&&w.getNative().clear();},null,null,9);}});CKEDITOR.editor.prototype.getSelection=function(){return this.document&&this.document.getSelection();};CKEDITOR.editor.prototype.forceNextSelectionCheck=function(){delete this._.selectionPreviousPath;};CKEDITOR.dom.document.prototype.getSelection=function(){var r=new CKEDITOR.dom.selection(this);return!r||r.isInvalid?null:r;};CKEDITOR.SELECTION_NONE=1;CKEDITOR.SELECTION_TEXT=2;CKEDITOR.SELECTION_ELEMENT=3;CKEDITOR.dom.selection=function(r){var u=this;var s=r.getCustomData('cke_locked_selection');if(s)return s;u.document=r;u.isLocked=0;u._={cache:{}};if(CKEDITOR.env.ie)try{var t=u.getNative().createRange();if(!t||t.item&&t.item(0).ownerDocument!=u.document.$||t.parentElement&&t.parentElement().ownerDocument!=u.document.$)throw 0;}catch(v){u.isInvalid=true;}return u;};var m={img:1,hr:1,li:1,table:1,tr:1,td:1,th:1,embed:1,object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,textarea:1,button:1,fieldset:1,thead:1,tfoot:1};CKEDITOR.dom.selection.prototype={getNative:CKEDITOR.env.ie?function(){return this._.cache.nativeSel||(this._.cache.nativeSel=this.document.$.selection);}:function(){return this._.cache.nativeSel||(this._.cache.nativeSel=this.document.getWindow().$.getSelection());},getType:CKEDITOR.env.ie?function(){var r=this._.cache;if(r.type)return r.type;var s=CKEDITOR.SELECTION_NONE;try{var t=this.getNative(),u=t.type;if(u=='Text')s=CKEDITOR.SELECTION_TEXT;if(u=='Control')s=CKEDITOR.SELECTION_ELEMENT;if(t.createRange().parentElement)s=CKEDITOR.SELECTION_TEXT;}catch(v){}return r.type=s;}:function(){var r=this._.cache;if(r.type)return r.type;var s=CKEDITOR.SELECTION_TEXT,t=this.getNative();if(!t)s=CKEDITOR.SELECTION_NONE;else if(t.rangeCount==1){var u=t.getRangeAt(0),v=u.startContainer;if(v==u.endContainer&&v.nodeType==1&&u.endOffset-u.startOffset==1&&m[v.childNodes[u.startOffset].nodeName.toLowerCase()])s=CKEDITOR.SELECTION_ELEMENT;}return r.type=s;
},getRanges:(function(){var r=CKEDITOR.env.ie?(function(){function s(u){return new CKEDITOR.dom.node(u).getIndex();};var t=function(u,v){u=u.duplicate();u.collapse(v);var w=u.parentElement(),x=w.ownerDocument;if(!w.hasChildNodes())return{container:w,offset:0};var y=w.children,z,A,B=u.duplicate(),C=0,D=y.length-1,E=-1,F,G,H;while(C<=D){E=Math.floor((C+D)/2);z=y[E];B.moveToElementText(z);F=B.compareEndPoints('StartToStart',u);if(F>0)D=E-1;else if(F<0)C=E+1;else if(CKEDITOR.env.ie9Compat&&z.tagName=='BR'){var I=x.defaultView.getSelection();return{container:I[v?'anchorNode':'focusNode'],offset:I[v?'anchorOffset':'focusOffset']};}else return{container:w,offset:s(z)};}if(E==-1||E==y.length-1&&F<0){B.moveToElementText(w);B.setEndPoint('StartToStart',u);G=B.text.replace(/(\r\n|\r)/g,'\n').length;y=w.childNodes;if(!G){z=y[y.length-1];if(z.nodeType!=CKEDITOR.NODE_TEXT)return{container:w,offset:y.length};else return{container:z,offset:z.nodeValue.length};}var J=y.length;while(G>0&&J>0){A=y[--J];if(A.nodeType==CKEDITOR.NODE_TEXT){H=A;G-=A.nodeValue.length;}}return{container:H,offset:-G};}else{B.collapse(F>0?true:false);B.setEndPoint(F>0?'StartToStart':'EndToStart',u);G=B.text.replace(/(\r\n|\r)/g,'\n').length;if(!G)return{container:w,offset:s(z)+(F>0?0:1)};while(G>0)try{A=z[F>0?'previousSibling':'nextSibling'];if(A.nodeType==CKEDITOR.NODE_TEXT){G-=A.nodeValue.length;H=A;}z=A;}catch(K){return{container:w,offset:s(z)};}return{container:H,offset:F>0?-G:H.nodeValue.length+G};}};return function(){var E=this;var u=E.getNative(),v=u&&u.createRange(),w=E.getType(),x;if(!u)return[];if(w==CKEDITOR.SELECTION_TEXT){x=new CKEDITOR.dom.range(E.document);var y=t(v,true);x.setStart(new CKEDITOR.dom.node(y.container),y.offset);y=t(v);x.setEnd(new CKEDITOR.dom.node(y.container),y.offset);if(x.endContainer.getPosition(x.startContainer)&CKEDITOR.POSITION_PRECEDING&&x.endOffset<=x.startContainer.getIndex())x.collapse();return[x];}else if(w==CKEDITOR.SELECTION_ELEMENT){var z=[];for(var A=0;A<v.length;A++){var B=v.item(A),C=B.parentNode,D=0;x=new CKEDITOR.dom.range(E.document);for(;D<C.childNodes.length&&C.childNodes[D]!=B;D++){}x.setStart(new CKEDITOR.dom.node(C),D);x.setEnd(new CKEDITOR.dom.node(C),D+1);z.push(x);}return z;}return[];};})():function(){var s=[],t,u=this.document,v=this.getNative();if(!v)return s;if(!v.rangeCount){t=new CKEDITOR.dom.range(u);t.moveToElementEditStart(u.getBody());s.push(t);}for(var w=0;w<v.rangeCount;w++){var x=v.getRangeAt(w);t=new CKEDITOR.dom.range(u);t.setStart(new CKEDITOR.dom.node(x.startContainer),x.startOffset);
t.setEnd(new CKEDITOR.dom.node(x.endContainer),x.endOffset);s.push(t);}return s;};return function(s){var t=this._.cache;if(t.ranges&&!s)return t.ranges;else if(!t.ranges)t.ranges=new CKEDITOR.dom.rangeList(r.call(this));if(s){var u=t.ranges;for(var v=0;v<u.length;v++){var w=u[v],x=w.getCommonAncestor();if(x.isReadOnly())u.splice(v,1);if(w.collapsed)continue;if(w.startContainer.isReadOnly()){var y=w.startContainer;while(y){if(y.is('body')||!y.isReadOnly())break;if(y.type==CKEDITOR.NODE_ELEMENT&&y.getAttribute('contentEditable')=='false')w.setStartAfter(y);y=y.getParent();}}var z=w.startContainer,A=w.endContainer,B=w.startOffset,C=w.endOffset,D=w.clone();if(z&&z.type==CKEDITOR.NODE_TEXT)if(B>=z.getLength())D.setStartAfter(z);else D.setStartBefore(z);if(A&&A.type==CKEDITOR.NODE_TEXT)if(!C)D.setEndBefore(A);else D.setEndAfter(A);var E=new CKEDITOR.dom.walker(D);E.evaluator=function(F){if(F.type==CKEDITOR.NODE_ELEMENT&&F.isReadOnly()){var G=w.clone();w.setEndBefore(F);if(w.collapsed)u.splice(v--,1);if(!(F.getPosition(D.endContainer)&CKEDITOR.POSITION_CONTAINS)){G.setStartAfter(F);if(!G.collapsed)u.splice(v+1,0,G);}return true;}return false;};E.next();}}return t.ranges;};})(),getStartElement:function(){var y=this;var r=y._.cache;if(r.startElement!==undefined)return r.startElement;var s,t=y.getNative();switch(y.getType()){case CKEDITOR.SELECTION_ELEMENT:return y.getSelectedElement();case CKEDITOR.SELECTION_TEXT:var u=y.getRanges()[0];if(u){if(!u.collapsed){u.optimize();while(1){var v=u.startContainer,w=u.startOffset;if(w==(v.getChildCount?v.getChildCount():v.getLength())&&!v.isBlockBoundary())u.setStartAfter(v);else break;}s=u.startContainer;if(s.type!=CKEDITOR.NODE_ELEMENT)return s.getParent();s=s.getChild(u.startOffset);if(!s||s.type!=CKEDITOR.NODE_ELEMENT)s=u.startContainer;else{var x=s.getFirst();while(x&&x.type==CKEDITOR.NODE_ELEMENT){s=x;x=x.getFirst();}}}else{s=u.startContainer;if(s.type!=CKEDITOR.NODE_ELEMENT)s=s.getParent();}s=s.$;}}return r.startElement=s?new CKEDITOR.dom.element(s):null;},getSelectedElement:function(){var r=this._.cache;if(r.selectedElement!==undefined)return r.selectedElement;var s=this,t=CKEDITOR.tools.tryThese(function(){return s.getNative().createRange().item(0);},function(){var u,v,w=s.getRanges()[0],x=w.getCommonAncestor(1,1),y={table:1,ul:1,ol:1,dl:1};for(var z in y){if(u=x.getAscendant(z,1))break;}if(u){var A=new CKEDITOR.dom.range(this.document);A.setStartAt(u,CKEDITOR.POSITION_AFTER_START);A.setEnd(w.startContainer,w.startOffset);
var B=CKEDITOR.tools.extend(y,CKEDITOR.dtd.$listItem,CKEDITOR.dtd.$tableContent),C=new CKEDITOR.dom.walker(A),D=function(E,F){return function(G,H){if(G.type==CKEDITOR.NODE_TEXT&&(!CKEDITOR.tools.trim(G.getText())||G.getParent().data('cke-bookmark')))return true;var I;if(G.type==CKEDITOR.NODE_ELEMENT){I=G.getName();if(I=='br'&&F&&G.equals(G.getParent().getBogus()))return true;if(H&&I in B||I in CKEDITOR.dtd.$removeEmpty)return true;}E.halted=1;return false;};};C.guard=D(C);if(C.checkBackward()&&!C.halted){C=new CKEDITOR.dom.walker(A);A.setStart(w.endContainer,w.endOffset);A.setEndAt(u,CKEDITOR.POSITION_BEFORE_END);C.guard=D(C,1);if(C.checkForward()&&!C.halted)v=u.$;}}if(!v)throw 0;return v;},function(){var u=s.getRanges()[0],v,w;for(var x=2;x&&!((v=u.getEnclosedNode())&&v.type==CKEDITOR.NODE_ELEMENT&&m[v.getName()]&&(w=v));x--)u.shrink(CKEDITOR.SHRINK_ELEMENT);return w.$;});return r.selectedElement=t?new CKEDITOR.dom.element(t):null;},getSelectedText:function(){var r=this._.cache;if(r.selectedText!==undefined)return r.selectedText;var s='',t=this.getNative();if(this.getType()==CKEDITOR.SELECTION_TEXT)s=CKEDITOR.env.ie?t.createRange().text:t.toString();return r.selectedText=s;},lock:function(){var r=this;r.getRanges();r.getStartElement();r.getSelectedElement();r.getSelectedText();r._.cache.nativeSel={};r.isLocked=1;r.document.setCustomData('cke_locked_selection',r);},unlock:function(r){var w=this;var s=w.document,t=s.getCustomData('cke_locked_selection');if(t){s.setCustomData('cke_locked_selection',null);if(r){var u=t.getSelectedElement(),v=!u&&t.getRanges();w.isLocked=0;w.reset();if(u)w.selectElement(u);else w.selectRanges(v);}}if(!t||!r){w.isLocked=0;w.reset();}},reset:function(){this._.cache={};},selectElement:function(r){var t=this;if(t.isLocked){var s=new CKEDITOR.dom.range(t.document);s.setStartBefore(r);s.setEndAfter(r);t._.cache.selectedElement=r;t._.cache.startElement=r;t._.cache.ranges=new CKEDITOR.dom.rangeList(s);t._.cache.type=CKEDITOR.SELECTION_ELEMENT;return;}s=new CKEDITOR.dom.range(r.getDocument());s.setStartBefore(r);s.setEndAfter(r);s.select();t.document.fire('selectionchange');t.reset();},selectRanges:function(r){var F=this;if(F.isLocked){F._.cache.selectedElement=null;F._.cache.startElement=r[0]&&r[0].getTouchedStartNode();F._.cache.ranges=new CKEDITOR.dom.rangeList(r);F._.cache.type=CKEDITOR.SELECTION_TEXT;return;}if(CKEDITOR.env.ie){if(r.length>1){var s=r[r.length-1];r[0].setEnd(s.endContainer,s.endOffset);r.length=1;}if(r[0])r[0].select();
F.reset();}else{var t=F.getNative();if(!t)return;if(r.length){t.removeAllRanges();CKEDITOR.env.webkit&&k(F.document);}for(var u=0;u<r.length;u++){if(u<r.length-1){var v=r[u],w=r[u+1],x=v.clone();x.setStart(v.endContainer,v.endOffset);x.setEnd(w.startContainer,w.startOffset);if(!x.collapsed){x.shrink(CKEDITOR.NODE_ELEMENT,true);var y=x.getCommonAncestor(),z=x.getEnclosedNode();if(y.isReadOnly()||z&&z.isReadOnly()){w.setStart(v.startContainer,v.startOffset);r.splice(u--,1);continue;}}}var A=r[u],B=F.document.$.createRange(),C=A.startContainer;if(A.collapsed&&(CKEDITOR.env.opera||CKEDITOR.env.gecko&&CKEDITOR.env.version<10900)&&C.type==CKEDITOR.NODE_ELEMENT&&!C.getChildCount())C.appendText('');if(A.collapsed&&CKEDITOR.env.webkit&&f(A)){var D=h(F.document);A.insertNode(D);var E=D.getNext();if(E&&!D.getPrevious()&&E.type==CKEDITOR.NODE_ELEMENT&&E.getName()=='br'){k(F.document);A.moveToPosition(E,CKEDITOR.POSITION_BEFORE_START);}else A.moveToPosition(D,CKEDITOR.POSITION_AFTER_END);}B.setStart(A.startContainer.$,A.startOffset);try{B.setEnd(A.endContainer.$,A.endOffset);}catch(G){if(G.toString().indexOf('NS_ERROR_ILLEGAL_VALUE')>=0){A.collapse(1);B.setEnd(A.endContainer.$,A.endOffset);}else throw G;}t.addRange(B);}F.document.fire('selectionchange');F.reset();}},createBookmarks:function(r){return this.getRanges().createBookmarks(r);},createBookmarks2:function(r){return this.getRanges().createBookmarks2(r);},selectBookmarks:function(r){var s=[];for(var t=0;t<r.length;t++){var u=new CKEDITOR.dom.range(this.document);u.moveToBookmark(r[t]);s.push(u);}this.selectRanges(s);return this;},getCommonAncestor:function(){var r=this.getRanges(),s=r[0].startContainer,t=r[r.length-1].endContainer;return s.getCommonAncestor(t);},scrollIntoView:function(){var r=this.getStartElement();r.scrollIntoView();}};var n=CKEDITOR.dom.walker.whitespaces(true),o=CKEDITOR.dom.walker.invisible(1),p=/\ufeff|\u00a0/,q={table:1,tbody:1,tr:1};CKEDITOR.dom.range.prototype.select=CKEDITOR.env.ie?function(r){var C=this;var s=C.collapsed,t,u,v,w=C.getEnclosedNode();if(w)try{v=C.document.$.body.createControlRange();v.addElement(w.$);v.select();return;}catch(D){}if(C.startContainer.type==CKEDITOR.NODE_ELEMENT&&C.startContainer.getName() in q||C.endContainer.type==CKEDITOR.NODE_ELEMENT&&C.endContainer.getName() in q)C.shrink(CKEDITOR.NODE_ELEMENT,true);var x=C.createBookmark(),y=x.startNode,z;if(!s)z=x.endNode;v=C.document.$.body.createTextRange();v.moveToElementText(y.$);v.moveStart('character',1);if(z){var A=C.document.$.body.createTextRange();
A.moveToElementText(z.$);v.setEndPoint('EndToEnd',A);v.moveEnd('character',-1);}else{var B=y.getNext(n);t=!(B&&B.getText&&B.getText().match(p))&&(r||!y.hasPrevious()||y.getPrevious().is&&y.getPrevious().is('br'));u=C.document.createElement('span');u.setHtml('&#65279;');u.insertBefore(y);if(t)C.document.createText('\ufeff').insertBefore(y);}C.setStartBefore(y);y.remove();if(s){if(t){v.moveStart('character',-1);v.select();C.document.$.selection.clear();}else v.select();C.moveToPosition(u,CKEDITOR.POSITION_BEFORE_START);u.remove();}else{C.setEndBefore(z);z.remove();v.select();}C.document.fire('selectionchange');}:function(){this.document.getSelection().selectRanges([this]);};})();

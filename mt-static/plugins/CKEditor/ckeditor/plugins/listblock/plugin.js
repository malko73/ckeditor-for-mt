CKEDITOR.plugins.add('listblock',{requires:['panel'],onLoad:function(){CKEDITOR.ui.panel.prototype.addListBlock=function(a,b){return this.addBlock(a,new CKEDITOR.ui.listBlock(this.getHolderElement(),b));};CKEDITOR.ui.listBlock=CKEDITOR.tools.createClass({base:CKEDITOR.ui.panel.block,$:function(a,b){var e=this;b=b||{};var c=b.attributes||(b.attributes={});(e.multiSelect=!!b.multiSelect)&&(c['aria-multiselectable']=true);!c.role&&(c.role='listbox');e.base.apply(e,arguments);var d=e.keys;d[40]='next';d[9]='next';d[38]='prev';d[CKEDITOR.SHIFT+9]='prev';d[32]=CKEDITOR.env.ie?'mouseup':'click';CKEDITOR.env.ie&&(d[13]='mouseup');e._.pendingHtml=[];e._.items={};e._.groups={};},_:{close:function(){if(this._.started){this._.pendingHtml.push('</ul>');delete this._.started;}},getClick:function(){if(!this._.click)this._.click=CKEDITOR.tools.addFunction(function(a){var c=this;var b=true;if(c.multiSelect)b=c.toggle(a);else c.mark(a);if(c.onClick)c.onClick(a,b);},this);return this._.click;}},proto:{add:function(a,b,c){var f=this;var d=f._.pendingHtml,e=CKEDITOR.tools.getNextId();if(!f._.started){d.push('<ul role="presentation" class=cke_panel_list>');f._.started=1;f._.size=f._.size||0;}f._.items[a]=e;d.push('<li id=',e,' class=cke_panel_listItem role=presentation><a id="',e,'_option" _cke_focus=1 hidefocus=true title="',c||a,'" href="javascript:void(\'',a,"')\" "+(CKEDITOR.env.ie?'onclick="return false;" onmouseup':'onclick')+'="CKEDITOR.tools.callFunction(',f._.getClick(),",'",a,"'); return false;\"",' role="option">',b||a,'</a></li>');},startGroup:function(a){this._.close();var b=CKEDITOR.tools.getNextId();this._.groups[a]=b;this._.pendingHtml.push('<h1 role="presentation" id=',b,' class=cke_panel_grouptitle>',a,'</h1>');},commit:function(){var a=this;a._.close();a.element.appendHtml(a._.pendingHtml.join(''));delete a._.size;a._.pendingHtml=[];},toggle:function(a){var b=this.isMarked(a);if(b)this.unmark(a);else this.mark(a);return!b;},hideGroup:function(a){var b=this.element.getDocument().getById(this._.groups[a]),c=b&&b.getNext();if(b){b.setStyle('display','none');if(c&&c.getName()=='ul')c.setStyle('display','none');}},hideItem:function(a){this.element.getDocument().getById(this._.items[a]).setStyle('display','none');},showAll:function(){var a=this._.items,b=this._.groups,c=this.element.getDocument();for(var d in a)c.getById(a[d]).setStyle('display','');for(var e in b){var f=c.getById(b[e]),g=f.getNext();f.setStyle('display','');if(g&&g.getName()=='ul')g.setStyle('display','');
}},mark:function(a){var d=this;if(!d.multiSelect)d.unmarkAll();var b=d._.items[a],c=d.element.getDocument().getById(b);c.addClass('cke_selected');d.element.getDocument().getById(b+'_option').setAttribute('aria-selected',true);d.onMark&&d.onMark(c);},unmark:function(a){var e=this;var b=e.element.getDocument(),c=e._.items[a],d=b.getById(c);d.removeClass('cke_selected');b.getById(c+'_option').removeAttribute('aria-selected');e.onUnmark&&e.onUnmark(d);},unmarkAll:function(){var e=this;var a=e._.items,b=e.element.getDocument();for(var c in a){var d=a[c];b.getById(d).removeClass('cke_selected');b.getById(d+'_option').removeAttribute('aria-selected');}e.onUnmark&&e.onUnmark();},isMarked:function(a){return this.element.getDocument().getById(this._.items[a]).hasClass('cke_selected');},focus:function(a){this._.focusIndex=-1;if(a){var b=this.element.getDocument().getById(this._.items[a]).getFirst(),c=this.element.getElementsByTag('a'),d,e=-1;while(d=c.getItem(++e)){if(d.equals(b)){this._.focusIndex=e;break;}}setTimeout(function(){b.focus();},0);}}}});}});
